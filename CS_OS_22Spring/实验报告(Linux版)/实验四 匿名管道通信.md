## 实验四 匿名管道通信

### 实验题目

匿名管道通信

### 实验目的

学习使用匿名管道在两个进程间建立通信。

### 实验软件环境

Ubuntu 21.04

### 实验内容

分别建立名为 Parent 的单文档应用程序和 Child 的单文档应用程
序作为父子进程，由父进程创建一个匿名管道，实现父子进程向匿
名管道写入和读取数据。

### 实验程序

```c
#include <sys/wait.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <stdio.h>
char buf[81];
int main( ) {
	int pipefd[2];
	int ret = 0;
	if ((ret = pipe(pipefd)) == -1) {
		printf("error pipe");
		exit(-1);
	}
	if (ret == 0) {
		int cpid = fork();
		if (cpid == -1) {
			printf("error fork");
			exit(-1);
		}
		if (cpid == 0) {
			char output[100];
			close(pipefd[1]);
			sleep(2);
			int t = 0;
			read(pipefd[0], &output, 80);
			printf("child read success\n");
			close(pipefd[0]);
			printf("child close success\n");
			printf("the data is %s\n", output);
			exit(0);
		} else if (cpid > 0) {
			close(pipefd[0]);
			FILE* fd = fopen("Parent.in", "r");	
			fgets(buf, 80, fd);
			write(pipefd[1], buf, strlen(buf));
			printf("parent writeline success\n");
			close(pipefd[1]);
			printf("parent close success\n");
			sleep(2);
		} 
	}
	return 0;
}
```



### 实验截图

![image-20220507121220722](../../../home/yjmstr/.config/Typora/typora-user-images/image-20220507121220722.png)